<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mouseland | Official Government Archive</title>

    <link rel="icon" type="image/png" href="../assets/img/mouseicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <meta name="theme-color" content="#10b981">
    <meta name="description"
        content="The official hub of Mouseland. Mice In Charge Updates, War Room, and National News. Official Archive.">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://anymouse.site/mouseland">
    <meta property="og:title" content="Mouseland | Official Government Site">
    <meta property="og:site_name" content="Mouseland Gov">
    <meta property="og:description"
        content="Official Archive of the Mice In Charge. Security Protocol: Active. Unity, Strength, Honor.">
    <meta property="og:image" content="https://anymouse.site/assets/img/mouselandcard.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Mouseland | Official Government Site">
    <meta name="twitter:description" content="Official Archive of the Mice In Charge. Security Protocol: Active.">
    <meta name="twitter:image" content="https://anymouse.site/assets/img/mouselandcard.png">

    <style>
        /* --- CONFIG & VARIABLES --- */
        :root {
            --bg-color: #09090b;
            --card-bg: #111113;
            --text-main: #e4e4e7;
            --text-muted: #a1a1aa;
            --mouseland-accent: #10b981;
            --link-color: #3b82f6;
            --danger: #ef4444;
            --warning: #f59e0b;
            --border: #27272a;
            --font-main: 'Inter', system-ui, -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', 'Courier New', monospace;
            --war-red: #8b0000;
        }

        /* --- DARK SCROLLBAR (FIXED) --- */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: #1a1a1e;
            border-radius: 5px;
            border: 2px solid #000;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--mouseland-accent);
        }

        /* --- CORE RESET --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* --- VISUAL EFFECTS --- */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }

        #intro-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 1.2s cubic-bezier(0.85, 0, 0.15, 1);
        }

        .intro-content {
            text-align: center;
        }

        .intro-title {
            font-size: clamp(3rem, 10vw, 5rem);
            font-weight: 900;
            color: var(--mouseland-accent);
            margin-bottom: 1rem;
            letter-spacing: 5px;
        }

        #enter-btn {
            background: transparent;
            border: 1px solid var(--mouseland-accent);
            color: var(--mouseland-accent);
            padding: 1.2rem 2.5rem;
            font-family: var(--font-mono);
            cursor: pointer;
            font-weight: bold;
            transition: 0.4s;
            text-transform: uppercase;
        }

        #enter-btn:hover {
            background: var(--mouseland-accent);
            color: #000;
            box-shadow: 0 0 30px var(--mouseland-accent);
        }

        /* --- LAYOUT --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            position: relative;
            z-index: 10;
        }

        .ml-header {
            padding: 5rem 0;
            margin-bottom: 3rem;
            border-bottom: 1px solid var(--border);
            background: radial-gradient(circle at top, rgba(16, 185, 129, 0.05) 0%, transparent 70%);
            text-align: center;
        }

        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .flag-img {
            width: 160px;
            border-radius: 4px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.9);
            margin-bottom: 2rem;
            border: 1px solid #444;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.8rem 1.6rem;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            transition: 0.2s;
        }

        .btn-mouseland {
            background: var(--mouseland-accent);
            color: #000;
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .btn-ghost:hover {
            color: #fff;
            border-color: #fff;
        }

        /* --- TERMINAL (STRICT SECURITY) --- */
        .admin-panel {
            background: #0a0a0c;
            border: 1px solid var(--border);
            border-left: 5px solid var(--mouseland-accent);
            padding: 3rem;
            border-radius: 8px;
            margin-bottom: 5rem;
            display: none;
        }

        .admin-input,
        .admin-textarea {
            background: #000;
            border: 1px solid #333;
            padding: 1.2rem;
            color: #fff;
            border-radius: 4px;
            width: 100%;
            margin-bottom: 15px;
            font-family: var(--font-mono);
        }

        /* --- WAR ROOM ARCHIVES (DETAILED) --- */
        .war-room-container {
            background: linear-gradient(180deg, rgba(15, 15, 15, 0.9), rgba(5, 5, 5, 1));
            border: 1px solid #1f1f23;
            border-top: 6px solid var(--danger);
            padding: 4rem;
            border-radius: 12px;
            margin: 6rem 0;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .war-stage {
            margin-bottom: 5rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #1a1a1a;
        }

        .war-stage h3 {
            color: var(--danger);
            text-transform: uppercase;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            font-family: var(--font-mono);
        }

        .war-stage p {
            font-size: 1.1rem;
            color: #a1a1aa;
            margin-bottom: 1.5rem;
            max-width: 950px;
        }

        .faction-highlight {
            font-weight: bold;
            color: var(--mouseland-accent);
        }

        .enemy-highlight {
            font-weight: bold;
            color: var(--danger);
        }

        .ally-highlight {
            font-weight: bold;
            color: var(--link-color);
        }

        .map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 3rem;
            margin-top: 4rem;
        }

        .map-card {
            background: #000;
            padding: 20px;
            border: 1px solid #222;
            border-radius: 12px;
            text-align: center;
        }

        .map-card img {
            width: 100%;
            border-radius: 6px;
            border: 1px solid #111;
            margin-bottom: 15px;
        }

        /* --- BROADCAST FEED --- */
        .news-section {
            margin-top: 8rem;
        }

        .news-archive-container {
            min-height: 600px;
            border: 1px solid #1a1a1a;
            padding: 3rem;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.4);
            width: 100%;
        }

        .news-item {
            background: #0c0c0e;
            border: 1px solid var(--border);
            padding: 3rem;
            border-radius: 8px;
            margin-bottom: 3rem;
            position: relative;
        }

        .news-item.urgent {
            border-left: 5px solid var(--danger);
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.05), transparent);
        }

        .news-item.war {
            border-left: 5px solid var(--warning);
        }

        .news-actions {
            display: none;
            gap: 20px;
        }

        .action-icon {
            cursor: pointer;
            font-size: 1.3rem;
            transition: 0.2s;
            opacity: 0.6;
        }

        .action-icon:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* --- EMBED SYSTEM --- */
        .embed-wrapper {
            margin-top: 25px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #222;
            background: #000;
        }

        .yt-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
        }

        .yt-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .link-preview-card {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background: #050505;
            border: 1px solid #222;
            border-radius: 12px;
            text-decoration: none !important;
            margin-top: 15px;
            transition: 0.2s;
        }

        .leadership-section {
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
            margin: 8rem 0;
        }

        .leader-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 4rem;
            border-radius: 20px;
            text-align: center;
            width: 340px;
            transition: 0.3s;
        }

        .leader-img {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--border);
            margin-bottom: 2rem;
        }

        /* --- SETTLEMENTS --- */
        .cities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 3rem;
            margin-top: 5rem;
        }

        .city-card {
            background: #050505;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #1a1a1a;
            text-align: center;
        }

        .city-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            opacity: 0.6;
            transition: 0.3s;
        }

        .city-card:hover img {
            opacity: 1;
        }

        .city-name {
            padding: 1.5rem;
            font-weight: 800;
            font-family: var(--font-mono);
            letter-spacing: 2px;
            text-transform: uppercase;
            font-size: 0.8rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(15px);
        }

        .modal-content {
            background: #0a0a0c;
            padding: 4rem;
            border-radius: 20px;
            border: 1px solid var(--mouseland-accent);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        footer {
            padding: 8rem 0;
            border-top: 1px solid #1a1a1a;
            text-align: center;
            color: #333;
            margin-top: 10rem;
            font-size: 0.9rem;
            font-family: var(--font-mono);
            letter-spacing: 4px;
        }
    </style>
</head>

<body>

    <audio id="bg-music" loop>
        <source src="../assets/audio/lofi.mp3" type="audio/mpeg">
    </audio>
    <audio id="sfx-hover">
        <source src="../assets/audio/hover.mp3" type="audio/mpeg">
    </audio>
    <audio id="sfx-click">
        <source src="../assets/audio/click.mp3" type="audio/mpeg">
    </audio>

    <canvas id="bg-canvas"></canvas>

    <div id="intro-overlay">
        <div class="intro-content">
            <div class="intro-title">MOUSELAND</div>
            <p style="color: #444; font-family: var(--font-mono); letter-spacing: 10px; margin-bottom: 4rem;">DECRYPTING
                ACCESS PROTOCOL // MIC_PRIVATE</p>
            <button id="enter-btn">INITIALIZE SYSTEMS</button>
        </div>
    </div>

    <div id="main-content">
        <header class="ml-header">
            <div class="container">
                <nav class="nav-bar">
                    <a href="https://anymouse.site" class="btn btn-ghost">‚Üê RETURN TO ANYMOUSE.SITE</a>
                    <div id="auth-container"><button id="login-trigger-btn" class="btn btn-mouseland">AUTH
                            LOGIN</button></div>
                </nav>
                <div>
                    <img src="../assets/img/mouselandflag.png" alt="State Flag" class="flag-img tilt-card">
                    <h1 class="tilt-card" style="font-size: 5rem; letter-spacing: -3px; font-weight: 900;">Mouseland Gov
                    </h1>
                    <p
                        style="color: var(--mouseland-accent); letter-spacing: 10px; font-weight: 900; text-transform: uppercase;">
                        Unity ‚Ä¢ Strength ‚Ä¢ Honor</p>
                </div>
            </div>
        </header>

        <div class="container">
            <section id="admin-panel" class="admin-panel">
                <h3 style="color: var(--mouseland-accent); margin-bottom: 2rem; font-family: var(--font-mono);"><i
                        class="fas fa-terminal"></i> Mice In Charge BROADCAST TERMINAL</h3>
                <div id="edit-indicator"
                    style="display:none; color: var(--warning); font-weight:900; margin-bottom: 1.5rem; text-transform: uppercase;">
                    [ WARN: Editing Active Log ]</div>
                <form id="post-form">
                    <input type="text" id="post-title" class="admin-input" placeholder="TRANS_TITLE" required>
                    <textarea id="post-content" class="admin-textarea" rows="5" placeholder="ENTER TRANSMISSION DATA..."
                        required></textarea>
                    <select id="post-type" class="admin-input">
                        <option value="standard">Standard Log</option>
                        <option value="urgent">üö® HIGH PRIORITY</option>
                        <option value="decree">üìú STATE DECREE</option>
                        <option value="war">‚öîÔ∏è COMBAT UPDATE</option>
                    </select>
                    <div style="display: flex; gap: 20px;">
                        <button type="submit" id="submit-btn" class="btn btn-mouseland"
                            style="flex: 2; height: 60px;">EXECUTE BROADCAST</button>
                        <button type="button" id="cancel-edit-btn" class="btn btn-danger"
                            style="display: none; flex: 1; height: 60px;">ABORT EDIT</button>
                    </div>
                </form>
            </section>

            <section class="leadership-section">
                <div class="leader-card tilt-card">
                    <img src="../assets/img/anymousxe.png" class="leader-img">
                    <h2 style="font-size: 2.5rem;">Anymousxe</h2>
                    <p style="color: var(--mouseland-accent); font-weight: 900; letter-spacing: 3px; margin-top: 1rem;">
                        Mice In Charge [CHIEF]</p>
                    <p
                        style="color: var(--text-muted); font-family: var(--font-mono); font-size: 0.8rem; margin-top: 5px;">
                        @anymousxe</p>
                </div>
                <div class="leader-card tilt-card">
                    <img src="../assets/img/color.png" class="leader-img">
                    <h2 style="font-size: 2.5rem;">Color</h2>
                    <p style="color: #a855f7; font-weight: 900; letter-spacing: 3px; margin-top: 1rem;">Vice Mice In
                        Charge [VICE]</p>
                    <p
                        style="color: var(--text-muted); font-family: var(--font-mono); font-size: 0.8rem; margin-top: 5px;">
                        @color_aqua</p>
                </div>
                <div class="leader-card tilt-card">
                    <img src="../assets/img/mat.png" class="leader-img">
                    <h2 style="font-size: 2.5rem;">Mat</h2>
                    <p style="color: #facc15; font-weight: 900; letter-spacing: 3px; margin-top: 1rem;">Head of Cheese
                    </p>
                    <p
                        style="color: var(--text-muted); font-family: var(--font-mono); font-size: 0.8rem; margin-top: 5px;">
                        @mat_tkd</p>
                </div>
                <div class="leader-card tilt-card">
                    <img src="../assets/img/roddy.png" class="leader-img">
                    <h2 style="font-size: 2.5rem;">Roddy</h2>
                    <p style="color: var(--link-color); font-weight: 900; letter-spacing: 3px; margin-top: 1rem;">Leader
                        of BBQ Chicken Land</p>
                    <p
                        style="color: var(--text-muted); font-family: var(--font-mono); font-size: 0.8rem; margin-top: 5px;">
                        War Ally [Joined to help]</p>
                </div>
            </section>

            <section class="news-section">
                <h2 style="margin-bottom: 4rem; font-size: 3rem; font-weight: 900; letter-spacing: -1px;">State
                    Broadcasts</h2>
                <div id="news-feed" class="news-archive-container">
                    <div style="text-align: center; padding: 5rem; color: #333; font-family: var(--font-mono);">SYNCING
                        SECURE FREQUENCY...</div>
                </div>
            </section>

            <section id="war-room" class="war-room-container">
                <h2
                    style="color: var(--danger); font-size: 4rem; text-transform: uppercase; margin-bottom: 3rem; font-weight: 900; letter-spacing: -2px;">
                    The War Archives</h2>
                <p style="color: #666; font-family: var(--font-mono); margin-bottom: 3rem;">Status: Active Conflict //
                    AI Reinforcement Phase</p>

                <div class="war-stage">
                    <h3>I: The Great Dipping Schism</h3>
                    <p>Conflict erupted at the border of <span class="faction-highlight">Rodentia Major</span> over
                        Nuggetland's illegal taxation of dipping sauce trade routes. Mouseland deployed the 1st
                        Battalion to secure the Honey Mustard pipelines, officially siding with <span
                            class="faction-highlight">Fryland</span> to maintain regional stability.</p>
                </div>

                <div class="war-stage">
                    <h3>II: The Triple Saturated Siege</h3>
                    <p>The coalition forces of <span class="enemy-highlight">Burgerland</span>, <span
                            class="enemy-highlight">Frogland</span>, and <span class="enemy-highlight">Cheeseland</span>
                        launched a massive pincer maneuver. Heavy artillery bombardment leveled 40% of the Boxborough
                        outskirts. Mouseland's defensive perimeter was pushed back to the inner cardboard
                        fortifications.</p>
                </div>

                <div class="war-stage">
                    <h3>III: The Salted Betrayal</h3>
                    <p>In a shock intelligence failure, <span class="faction-highlight">Fryland</span> forces initiated
                        the "Salt-Flank" maneuver, backstabbing Mouseland mid-siege. Our supply lines were severed,
                        leaving our forward troops isolated in the Rubbish Heights. <strong>MIC High Command</strong>
                        initiated emergency blackout protocols.</p>
                </div>

                <div class="war-stage">
                    <h3>IV: The Whisker-Websim Breach</h3>
                    <p>The <span class="ally-highlight">United Whisker Union</span> (UWU) launched a surprise
                        counter-offensive from the attic vents, flanking the coalition tanks. Simultaneously, MIC
                        initiated the <strong>Websim Protocol</strong>, opening a digital bridge to <span
                            class="ally-highlight">United Websim</span> for infinite server-side reinforcement.</p>
                </div>

                <div class="war-stage" style="border-bottom: none;">
                    <h3>V: Current Status: Trench Warfare at the Grease-Line</h3>
                    <p>The frontlines have stabilized around <span class="faction-highlight">MEC City</span>. Over
                        50,000 <span class="ally-highlight">Websim AI Combat Bots</span> are currently engaged in a
                        brutal 24/7 skirmish to prevent a total coalition breakthrough. Defensive status: <strong>DEFCON
                            1</strong>. Every citizen is a soldier. Victory is the only option.</p>
                </div>

                <div class="map-grid">
                    <div class="map-card tilt-card">
                        <img src="../assets/img/mouselandmap.png" alt="National Map">
                        <p style="font-size: 0.7rem; color: #444; margin-top: 10px;">Territorial Grid v2.1</p>
                    </div>
                    <div class="map-card tilt-card">
                        <img src="../assets/img/mouseland%20war%20map.png" alt="Combat Map">
                        <p style="font-size: 0.7rem; color: var(--danger); margin-top: 10px;">Active Frontlines // THE
                            GREASE-LINE SECTOR</p>
                    </div>
                </div>
            </section>

            <section style="margin-top: 12rem;">
                <h2
                    style="text-align: center; text-transform: uppercase; letter-spacing: 15px; font-weight: 200; font-size: 1.2rem; margin-bottom: 6rem; color: #333;">
                    The 5 Great Settlements</h2>
                <div class="cities-grid">
                    <div class="city-card"><img src="../assets/img/boxborough.png">
                        <div class="city-name">BOXBOROUGH</div>
                    </div>
                    <div class="city-card"><img src="../assets/img/corrugatecrossing.png">
                        <div class="city-name">CORRUGATE_CROSSING</div>
                    </div>
                    <div class="city-card"><img src="../assets/img/rodentiamajor.png">
                        <div class="city-name">RODENTIA_MAJOR</div>
                    </div>
                    <div class="city-card"><img src="../assets/img/rubbishheights.png">
                        <div class="city-name">RUBBISH_HEIGHTS</div>
                    </div>
                    <div class="city-card"><img src="../assets/img/mec.png">
                        <div class="city-name">MEC_CITY</div>
                    </div>
                </div>
            </section>
        </div>

        <footer>
            <p>&copy; 2026 MOUSELAND GOV ARCHIVE // OPERATOR: ANYMOUSXE // SECURE_V3</p>
        </footer>
    </div>

    <div id="login-modal" class="modal">
        <div class="modal-content">
            <h2 style="font-size: 2.5rem; letter-spacing: -2px; margin-bottom: 3rem;">IDENT_PROTO</h2>
            <button id="google-auth-btn" class="btn btn-mouseland"
                style="width:100%; height: 60px; margin-bottom: 2rem;">SYNC GOOGLE ID</button>
            <form id="email-auth-form">
                <input type="email" id="auth-email" class="admin-input" placeholder="User@Email" required>
                <input type="password" id="auth-password" class="admin-input" placeholder="Passcode" required>
                <button type="submit" class="btn btn-ghost" style="width:100%; height: 60px;">ACCESS TERMINAL</button>
            </form>
            <p id="auth-error"
                style="color:var(--danger); display:none; margin-top:2rem; font-family: var(--font-mono); font-size: 0.75rem;">
            </p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, deleteDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // --- VISUAL ENGINE ---
        document.addEventListener('DOMContentLoaded', () => {
            const enterBtn = document.getElementById('enter-btn');
            const overlay = document.getElementById('intro-overlay');
            const bgMusic = document.getElementById('bg-music');
            if (bgMusic) bgMusic.volume = 0.2;

            enterBtn.onclick = () => {
                document.getElementById('sfx-click').play();
                bgMusic.play().catch(() => { });
                overlay.style.transform = 'translateY(-100%)';
            };

            const canvas = document.getElementById('bg-canvas');
            const ctx = canvas.getContext('2d');
            let particles = [];
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;

            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 1.5;
                    this.speedX = (Math.random() - 0.5) * 0.4;
                    this.speedY = (Math.random() - 0.5) * 0.4;
                }
                update() {
                    this.x += this.speedX; this.y += this.speedY;
                    if (this.x > canvas.width || this.x < 0) this.speedX *= -1;
                    if (this.y > canvas.height || this.y < 0) this.speedY *= -1;
                }
                draw() {
                    ctx.fillStyle = '#10b981'; ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill();
                }
            }
            for (let i = 0; i < 120; i++) particles.push(new Particle());
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => { p.update(); p.draw(); });
                requestAnimationFrame(animate);
            }
            animate();
        });

        // --- FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyDsoQrx2jyRQzwJ3XhB3biznqQLdmJtEKY",
            authDomain: "mouseland-istuff.firebaseapp.com",
            projectId: "mouseland-istuff",
            storageBucket: "mouseland-istuff.firebasestorage.app",
            messagingSenderId: "459629527486",
            appId: "1:459629527486:web:0c038f1fad27ef288879ef"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        // SHA-256 Hashes of Allowed Admin Emails
        const WHITELIST_HASHES = [
            "a584ea91d34ed0e0715b7d57c9c15751ade2c473872d68f7e83f86d2e3e6c1db", // anymousxe.info@gmail.com
            "06f98c9d84172e5f185f0fcf9ffc98663134280787f3fce3fa3aad5da1c97ef5"  // colorvicemouseincharge@proton.me
        ];

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        let isEditing = false;
        let editDocId = null;

        const modal = document.getElementById('login-modal');
        const adminPanel = document.getElementById('admin-panel');
        const newsFeed = document.getElementById('news-feed');
        const postForm = document.getElementById('post-form');

        function formatContent(text) {
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            let embeds = "";
            const formattedText = text.replace(urlRegex, (url) => {
                const ytMatch = url.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
                if (ytMatch) {
                    const videoId = ytMatch[1];
                    embeds += `<div class="embed-wrapper"><div class="yt-container"><iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe></div></div>`;
                } else {
                    embeds += `<a href="${url}" target="_blank" class="link-preview-card"><i class="fas fa-link"></i><div style="font-size:0.8rem;color:#aaa;">EXTERNAL: ${url}</div></a>`;
                }
                return `<a href="${url}" target="_blank" style="color:var(--link-color);">${url}</a>`;
            });
            return `<div>${formattedText}</div>${embeds}`;
        }

        // --- AUTH ---
        onAuthStateChanged(auth, async (user) => {
            let isAdmin = false;
            if (user && user.email) {
                const emailHash = await sha256(user.email.toLowerCase());
                isAdmin = WHITELIST_HASHES.includes(emailHash);
            }

            adminPanel.style.display = isAdmin ? "block" : "none";

            if (user && !isAdmin) {
                // Show a small notification or just keep admin panel hidden
                // Creating a subtle toast notification for civilians
                let toast = document.getElementById('civilian-toast');
                if (!toast) {
                    toast = document.createElement('div');
                    toast.id = 'civilian-toast';
                    toast.style.cssText = "position:fixed; bottom:20px; right:20px; background:#111; color:#aaa; border:1px solid #333; padding:15px; border-radius:5px; font-family:monospace; font-size:0.8rem; z-index:9999;";
                    toast.innerText = "IDENTITY: CIVILIAN // ADMIN PANEL: LOCKED";
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 5000);
                }
            }
            const container = document.getElementById('auth-container');
            if (user) {
                container.innerHTML = `<button id="logout-btn" class="btn btn-ghost">DISCONNECT</button>`;
                document.getElementById('logout-btn').onclick = () => signOut(auth);
            } else {
                container.innerHTML = `<button id="login-trigger-btn" class="btn btn-mouseland">AUTH LOGIN</button>`;
                document.getElementById('login-trigger-btn').onclick = () => modal.style.display = 'flex';
            }
        });

        // --- POSTING ---
        postForm.onsubmit = async (e) => {
            e.preventDefault();
            const user = auth.currentUser;
            if (!user) return;

            const emailHash = await sha256(user.email.toLowerCase());
            if (!WHITELIST_HASHES.includes(emailHash)) return;

            const payload = {
                title: document.getElementById('post-title').value,
                content: document.getElementById('post-content').value,
                type: document.getElementById('post-type').value,
                author: user.email.includes("anymousxe") ? "Anymousxe" : "Color",
                role: user.email.includes("anymousxe") ? "Mice In Charge" : "Vice Mice In Charge",
                pfp: user.email.includes("anymousxe") ? "anymousxe.png" : "color.png",
                updatedAt: serverTimestamp()
            };

            if (isEditing) {
                await updateDoc(doc(db, "updates", editDocId), payload);
                resetForm();
            } else {
                payload.createdAt = serverTimestamp();
                await addDoc(collection(db, "updates"), payload);
                postForm.reset();
            }
        };

        function resetForm() {
            isEditing = false; editDocId = null; postForm.reset();
            document.getElementById('submit-btn').textContent = "EXECUTE BROADCAST";
            document.getElementById('cancel-edit-btn').style.display = "none";
            document.getElementById('edit-indicator').style.display = "none";
        }
        document.getElementById('cancel-edit-btn').onclick = resetForm;

        // --- FEED ---
        onSnapshot(query(collection(db, "updates"), orderBy("createdAt", "desc")), (snapshot) => {
            newsFeed.innerHTML = "";
            const user = auth.currentUser;
            let isAdmin = false;

            // We need to check admin status async, but snapshot is sync.
            // We'll trust the UI hiding for now, and strictly verify on actions if needed.
            // For the edit buttons, we can do a quick check if user is present, 
            // but the real protection is in the write rules and the earlier auth check.
            // However, to show/hide buttons correctly:

            if (user && user.email) {
                // This is a bit tricky inside a sync callback without making it async (which onSnapshot supports but might delay rendering)
                // We'll use a cached value or re-calculate. simpler to just calculate.
                // Actually easier to just check against the plain email if we had it, but we removed the plain list!
                // So we must re-hash.
                sha256(user.email.toLowerCase()).then(hash => {
                    isAdmin = WHITELIST_HASHES.includes(hash);
                    renderFeed(isAdmin);
                });
            } else {
                renderFeed(false);
            }

            function renderFeed(adminStatus) {
                newsFeed.innerHTML = ""; // Clear again to be safe
                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const item = document.createElement('div');

                    let emoji = "üìù";
                    if (data.type === "urgent") emoji = "üö®";
                    if (data.type === "war") emoji = "‚öîÔ∏è";
                    if (data.type === "decree") emoji = "üìú";

                    item.className = `news-item ${data.type}`;
                    item.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <div style="display:flex; gap:15px; align-items:center;">
                                <img src="../assets/img/${data.pfp}" style="width:45px; height:45px; border-radius:50%; border:2px solid #222;">
                                <div>
                                    <div style="font-weight:900;">${data.author} <span style="font-size:0.6rem; background:var(--mouseland-accent); color:#000; padding:2px 8px; border-radius:3px;">${data.role}</span></div>
                                    <div style="font-size:0.7rem; color:#444;">${data.createdAt?.toDate().toLocaleString() || 'TRANSMITTING...'}</div>
                                </div>
                            </div>
                            ${adminStatus ? `
                                <div class="news-actions" style="display:flex;">
                                    <i class="fa-solid fa-pen-to-square action-icon" style="color:var(--link-color);" data-id="${docSnap.id}"></i>
                                    <i class="fa-solid fa-trash-can action-icon" style="color:var(--danger);" data-id="${docSnap.id}"></i>
                                </div>
                            ` : ''}
                        </div>
                        <h3 style="margin:2.5rem 0 1rem 0; font-size:1.8rem; color:${data.type === 'war' ? 'var(--danger)' : '#fff'};">${emoji} ${data.title}</h3>
                        <div style="color:#aaa; font-size:1.05rem;">${formatContent(data.content)}</div>
                    `;
                    newsFeed.appendChild(item);
                });

                // Re-attach listeners
                if (adminStatus) {
                    document.querySelectorAll('.fa-trash-can').forEach(b => {
                        b.onclick = async () => { if (confirm("ERASE LOG?")) await deleteDoc(doc(db, "updates", b.dataset.id)); };
                    });
                    document.querySelectorAll('.fa-pen-to-square').forEach(b => {
                        b.onclick = () => {
                            const id = b.dataset.id;
                            const d = snapshot.docs.find(s => s.id === id).data();
                            document.getElementById('post-title').value = d.title;
                            document.getElementById('post-content').value = d.content;
                            document.getElementById('post-type').value = d.type;
                            isEditing = true; editDocId = id;
                            document.getElementById('submit-btn').textContent = "SAVE LOG EDIT";
                            document.getElementById('cancel-edit-btn').style.display = "block";
                            document.getElementById('edit-indicator').style.display = "block";
                            adminPanel.scrollIntoView({ behavior: 'smooth' });
                        };
                    });
                }
            }
        });


        document.querySelectorAll('.tilt-card').forEach(c => { c.onmouseenter = () => document.getElementById('sfx-hover').play(); });
        window.onclick = (e) => { if (e.target == modal) modal.style.display = 'none'; };
        document.getElementById('google-auth-btn').onclick = () => signInWithPopup(auth, provider).then(() => modal.style.display = 'none');
    </script>
</body>

</html>