<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anymouse AI Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .loader { border-top-color: #3b82f6; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen p-4 md:p-10 flex flex-col items-center">

    <div class="glass w-full max-w-4xl p-8 rounded-3xl shadow-2xl">
        <div class="flex justify-between items-start mb-8">
            <div>
                <h1 class="text-4xl font-black text-blue-500 tracking-tighter">ANYMOUSE AI</h1>
                <p class="text-gray-500 font-medium">Sora 2 & NB Pro Dashboard</p>
            </div>
            <div id="auth-status" class="text-right">
                <button id="login-btn" class="bg-white text-black px-6 py-2 rounded-full font-bold hover:bg-gray-200 transition">Login</button>
                <div id="user-pill" class="hidden glass px-4 py-2 rounded-full border border-white/10 text-sm">
                    <span id="user-email" class="font-mono text-blue-400"></span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="glass p-4 rounded-2xl">
                <p class="text-xs text-gray-500 uppercase font-bold">NB Pro Daily</p>
                <p id="limit-nb" class="text-2xl font-black">-- / --</p>
            </div>
            <div class="glass p-4 rounded-2xl">
                <p class="text-xs text-gray-500 uppercase font-bold">Sora 2 Daily</p>
                <p id="limit-sora" class="text-2xl font-black">-- / --</p>
            </div>
        </div>

        <div class="flex gap-2 mb-6 p-1 bg-white/5 rounded-2xl">
            <button onclick="setModel('nbpro')" id="btn-nbpro" class="flex-1 py-3 rounded-xl font-bold transition bg-blue-600 text-white">NB PRO</button>
            <button onclick="setModel('sora')" id="btn-sora" class="flex-1 py-3 rounded-xl font-bold transition text-gray-400">SORA 2</button>
        </div>

        <textarea id="prompt-input" placeholder="What should I generate?..." 
            class="w-full h-40 bg-black/50 border border-white/10 rounded-2xl p-6 text-xl outline-none focus:border-blue-500 transition mb-6 resize-none"></textarea>
        
        <button id="gen-btn" class="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-2xl font-black text-xl transition transform active:scale-95 shadow-xl shadow-blue-900/20">
            GENERATE NOW
        </button>

        <div id="status-box" class="hidden mt-8 p-6 rounded-2xl border border-blue-500/20 bg-blue-500/5 flex items-center gap-4">
            <div class="loader w-6 h-6 border-4 border-white/10 rounded-full"></div>
            <p id="status-msg" class="text-blue-400 font-medium italic">Waking up the models...</p>
        </div>

        <div id="output-screen" class="hidden mt-10 space-y-6">
            <div class="flex justify-between items-center">
                <h3 class="font-bold text-gray-400">GENERATION RESULT</h3>
                <button id="download-btn" class="text-sm bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg font-bold">Download</button>
            </div>
            <div id="result-viewer" class="rounded-3xl overflow-hidden bg-black border border-white/10 aspect-video flex items-center justify-center">
                </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDQacpiI3oIqOUx8ciMfdlQgBtHZEVdcMo",
            authDomain: "anymousxe-aistudio.firebaseapp.com",
            projectId: "anymousxe-aistudio",
            storageBucket: "anymousxe-aistudio.firebasestorage.app",
            messagingSenderId: "518478280058",
            appId: "1:518478280058:web:422404fc54c21e5ea312c3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        let activeModel = 'nbpro';
        let currentResultBlob = null;

        window.setModel = (m) => {
            activeModel = m;
            document.getElementById('btn-nbpro').className = m === 'nbpro' ? 'flex-1 py-3 rounded-xl font-bold transition bg-blue-600 text-white' : 'flex-1 py-3 rounded-xl font-bold transition text-gray-400 hover:text-white';
            document.getElementById('btn-sora').className = m === 'sora' ? 'flex-1 py-3 rounded-xl font-bold transition bg-blue-600 text-white' : 'flex-1 py-3 rounded-xl font-bold transition text-gray-400 hover:text-white';
        };

        document.getElementById('login-btn').onclick = () => signInWithPopup(auth, new GoogleAuthProvider());

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('login-btn').classList.add('hidden');
                document.getElementById('user-pill').classList.remove('hidden');
                document.getElementById('user-email').innerText = user.email;
                updateLimits(user.email);
            }
        });

        async function updateLimits(email) {
            // Placeholder for the real logic you requested for admin/user limits
            const isBoss = email === 'anymousexe.info@gmail.com';
            document.getElementById('limit-nb').innerText = isBoss ? "∞ / ∞" : "0 / 5";
            document.getElementById('limit-sora').innerText = isBoss ? "∞ / ∞" : "0 / 2";
        }

        document.getElementById('gen-btn').onclick = async () => {
            const prompt = document.getElementById('prompt-input').value;
            if (!prompt) return alert("You gotta type a prompt first!");

            const statusBox = document.getElementById('status-box');
            const statusMsg = document.getElementById('status-msg');
            statusBox.classList.remove('hidden');
            statusMsg.innerText = "Launching virtual browser (this takes ~45s)...";

            try {
                const response = await fetch(`/api/${activeModel}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });

                const data = await response.json();
                if (data.success) {
                    displayResult(data.mediaData, activeModel);
                } else {
                    alert("Model Error: " + data.error);
                }
            } catch (e) {
                alert("Vercel timed out! The generation is likely still running on the provider's end, but Vercel cut the connection.");
            } finally {
                statusBox.classList.add('hidden');
            }
        };

        function displayResult(base64, model) {
            const viewer = document.getElementById('result-viewer');
            const screen = document.getElementById('output-screen');
            screen.classList.remove('hidden');
            
            if (model === 'nbpro') {
                viewer.innerHTML = `<img src="${base64}" class="w-full h-full object-contain">`;
            } else {
                viewer.innerHTML = `<video src="${base64}" controls autoplay class="w-full h-full object-contain"></video>`;
            }
            currentResultBlob = base64;
        }

        document.getElementById('download-btn').onclick = () => {
            if (!currentResultBlob) return;
            const link = document.createElement('a');
            link.href = currentResultBlob;
            link.download = `anymouse-gen-${Date.now()}.${activeModel === 'nbpro' ? 'png' : 'mp4'}`;
            link.click();
        };
    </script>
</body>
</html>
